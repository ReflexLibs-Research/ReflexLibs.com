<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="color-scheme" content="light dark">
  <title>ReflexLibs Timeline</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      display: flex;
      font-family: 'Poppins', sans-serif;
      height: 100vh;
    }
    .column {
      width: 50%;
      overflow-y: auto;
      padding: 1rem 2rem;
      box-sizing: border-box;
    }
    .column ul {
      list-style: none;
      margin: 0;
      padding-left: 0;
    }
    .white-bg { background: #fff; color: #000; }
    .black-bg { background: #000; color: #fff; }

    .svg-header img {
      max-width: 400px;
      width: 100%;
      height: auto;
      display: block;
      margin: 0 auto 1rem;
    }

    .lang-box {
      border-radius: 16px;
      padding: 1rem;
      width: 480px;
      margin: 0 auto 1rem;
    }
    .white-bg .lang-box {
      background: #f9f9f9;
      border: 1px solid #ddd;
    }
    .black-bg .lang-box {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .white-bg .lang-box ul {
      list-style-type: disc;
      list-style-position: inside;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin: 0 0 1rem;
    }
    .black-bg .lang-box ul {
      list-style-type: disc;
      list-style-position: inside;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin: 0 0 1rem;
    }
    .lang-box li {
      margin-bottom: 0.5rem;
    }

    .icon-container {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 0.5rem;
    }
    .icon-container img {
      width: 48px;
      height: 48px;
    }

    .section {
      margin-bottom: 2rem;
    }
    .title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .column .section ul {
      list-style: none !important;
      margin: 0;
      padding-left: 0;
    }
    .column .section li {
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body>
  <div id="left-container" class="column"></div>
  <div id="right-container" class="column"></div>

<script>
  // ─── 1) Environment flags ────────────────────────────────────────────────
  const DevOrProd  = 'Prod';    // 'Dev' or 'Prod'
  const DotComOrAI = 'DotCom';  // 'DotCom' or 'AI'
  const isLocal    = location.hostname === 'localhost' || location.protocol === 'file:';
  const localBase  = isLocal ? 'public/' : '/public/';

  // ─── 2) Remote vs Local URL bases ────────────────────────────────────────
  const domain        = DevOrProd === 'Dev'
    ? 'https://devriskevolutionwebservice.azurewebsites.net'
    : 'https://riskevolutioninflationservice.azurewebsites.net';

  const apiRemoteBase  = `${domain}/reflexLibs/`;
  const logoRemoteBase = `${apiRemoteBase}ReflexLibsLogo/`;
  const iconRemoteBase = `${domain}/Icon/Generic/Get?Category=math&SubCategory=ProgLanguage&Size=64x64&Name=`;

  const apiLocalBase   = `${localBase}data/`;
  const logoLocalBase  = `${localBase}assets/img/ReflexLibsLogo/`;
  const iconLocalBase  = `${localBase}assets/img/icons/`;
  const defaultIcon    = `${iconLocalBase}default.png`;

  // ─── 3) Helper: remote JSON → local JSON fallback ────────────────────────
  async function fetchWithFallback(remoteUrl, localUrl) {
    try {
      const r = await fetch(remoteUrl, { cache: 'no-cache' });
      if (!r.ok) throw new Error(r.status);
      return await r.json();
    } catch {
      const r = await fetch(localUrl);
      if (!r.ok) throw new Error(`Missing local data: ${localUrl}`);
      return await r.json();
    }
  }

  // ─── 4) Load version/timestamp + sections ────────────────────────────────
  ;(async function loadVersionAndSections() {
    const remoteMetaUrl = `${apiRemoteBase}sections`;
    const localMetaUrl  = `${apiLocalBase}sections.json`;
    let meta;
    try {
      meta = await fetchWithFallback(remoteMetaUrl, localMetaUrl);
    } catch (e) {
      console.error('Failed to load master sections JSON:', e);
      return;
    }

    // 4a) Show version & timestamp under each logo
    configs.com.version   = meta.version;
    configs.com.timestamp = meta.timestamp;
    configs.ai.version    = meta.version;
    configs.ai.timestamp  = meta.timestamp;

    // 4b) Attach sections payload
    configs.com.sections = meta.sections;
    configs.ai.sections  = meta.sections;

    // 4c) Now render the two columns
    const layoutMap = {
      DotCom: { left: configs.com, right: configs.ai },
      AI:     { left: configs.ai,  right: configs.com }
    };
    const layout = layoutMap[DotComOrAI];
    renderColumn('left-container',  layout.left);
    renderColumn('right-container', layout.right);
  })();

  // ─── 5) Base configs (sections filled above) ─────────────────────────────
  const configs = {
    com: {
      langApiRemote: `${apiRemoteBase}reflexlanguages2018`,
      langApiLocal:  `${apiLocalBase}reflexlanguages2018.json`,
      logoKey:       'com',
      icons:         ['CPlusPlus','CSharp','Python','Rust','JavaScript'],
      link:          'https://www.reflexlibs.com',
      bgClass:       'white-bg'
    },
    ai: {
      langApiRemote: `${apiRemoteBase}reflexlanguages2025`,
      langApiLocal:  `${apiLocalBase}reflexlanguages2025.json`,
      logoKey:       'ai',
      icons:         ['CPlusPlus','CSharp','Python','Rust','JavaScript'],
      link:          'https://www.reflexlibs.ai',
      bgClass:       'black-bg'
    }
  };

  // ─── 6) Render a column ───────────────────────────────────────────────────
  function renderColumn(containerId, cfg) {
    const c = document.getElementById(containerId);
    c.className = `column ${cfg.bgClass}`;

    // Logo + link
    const link = document.createElement('a');
    link.href   = cfg.link;
    link.target = '_blank';
    const logo  = document.createElement('img');
    logo.src    = `${logoRemoteBase}${cfg.logoKey}.png`;
    logo.alt    = 'ReflexLibs Logo';
    logo.onerror = () => {
      logo.onerror = null;
      logo.src     = `${logoLocalBase}${cfg.logoKey}.png`;
    };
    link.appendChild(logo);
    c.appendChild(link);

    // Version/timestamp (small text)
    if (cfg.version && cfg.timestamp) {
      const v = document.createElement('div');
      v.className = 'version-text';
      const ts = new Date(cfg.timestamp).toLocaleString();
      v.textContent = `v${cfg.version} — ${ts}`;
      c.appendChild(v);
    }

    // Language icons
    const box      = document.createElement('div'); box.className = 'lang-box';
    const iconsDiv = document.createElement('div'); iconsDiv.className = 'icon-container';
    cfg.icons.forEach(name => {
      const img = document.createElement('img');
      img.src   = `${iconRemoteBase}${encodeURIComponent(name)}`;
      img.alt   = name;
      img.onerror = () => {
        img.onerror = null;
        img.src     = `${iconLocalBase}${name}.png`;
        img.onerror = () => { img.src = defaultIcon; };
      };
      iconsDiv.appendChild(img);
    });
    box.appendChild(iconsDiv);
    c.appendChild(box);

    // Language bullets
    fetchWithFallback(cfg.langApiRemote, cfg.langApiLocal)
      .then(data => {
        const list = Array.isArray(data.bullets) ? data.bullets
                   : Array.isArray(data.Bullets) ? data.Bullets
                   : [];
        if (list.length) {
          const ul = document.createElement('ul');
          list.forEach(txt => {
            const li = document.createElement('li');
            li.textContent = txt;
            ul.appendChild(li);
          });
          box.appendChild(ul);
        }
      })
      .catch(e => console.error('Bullets error:', e));

    // Timeline sections from loaded JSON
    if (Array.isArray(cfg.sections)) {
      cfg.sections.forEach(s => appendSection(c, s));
    }
  }

  // ─── 7) Helper to append a section block ─────────────────────────────────
  function appendSection(container, s) {
    const sec = document.createElement('div'); sec.className = 'section';
    const t   = document.createElement('div'); t.className = 'title';
    t.textContent = `${s.sectionID}. ${s.title}`;
    sec.appendChild(t);

    const ul = document.createElement('ul');
    (s.items || []).forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      ul.appendChild(li);
    });
    sec.appendChild(ul);
    container.appendChild(sec);
  }
</script>

</body>
</html>
