<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="color-scheme" content="light dark">
  <title>ReflexLibs Timeline</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      display: flex;
      font-family: 'Poppins', sans-serif;
      height: 100vh;
    }
    .column {
      width: 50%;
      overflow-y: auto;
      padding: 1rem 2rem;
      box-sizing: border-box;
    }
    .column ul {
      list-style: none;
      margin: 0;
      padding-left: 0;
    }
    .white-bg { background: #fff; color: #000; }
    .black-bg { background: #000; color: #fff; }

    .svg-header img {
      max-width: 400px;
      width: 100%;
      height: auto;
      display: block;
      margin: 0 auto 1rem;
    }

    .lang-box {
      border-radius: 16px;
      padding: 1rem;
      width: 480px;
      margin: 0 auto 1rem;
    }
    .white-bg .lang-box {
      background: #f9f9f9;
      border: 1px solid #ddd;
    }
    .black-bg .lang-box {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .white-bg .lang-box ul {
      list-style-type: disc;
      list-style-position: inside;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin: 0 0 1rem;
    }
    .black-bg .lang-box ul {
      list-style-type: disc;
      list-style-position: inside;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin: 0 0 1rem;
    }
    .lang-box li {
      margin-bottom: 0.5rem;
    }

    .icon-container {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 0.5rem;
    }
    .icon-container img {
      width: 48px;
      height: 48px;
    }

    .section {
      margin-bottom: 2rem;
    }
    .title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .column .section ul {
      list-style: none !important;
      margin: 0;
      padding-left: 0;
    }
    .column .section li {
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body>
  <div id="left-container" class="column"></div>
  <div id="right-container" class="column"></div>

<script>
  const DevOrProd = 'Dev'; // or 'Prod'
  const isLocal   = location.hostname === 'localhost' || location.protocol === 'file:';
  const base      = isLocal ? 'public/' : '/public/';

  const domain         = DevOrProd === 'Dev'
    ? 'https://devriskevolutionwebservice.azurewebsites.net'
    : 'https://riskevolutioninflationservice.azurewebsites.net';
  const apiRemoteBase  = `${domain}/reflexLibs/`;
  const logoRemoteBase = `${apiRemoteBase}ReflexLibsLogo/`;
  const iconRemoteBase = `${domain}/Icon/Generic/Get?Category=math&SubCategory=ProgLanguage&Size=64x64&Name=`;

  const apiLocalBase   = `${base}data/`;
  const logoLocalBase  = `${base}assets/img/ReflexLibsLogo/`;
  const iconLocalBase  = `${base}assets/img/icons/`;

  async function fetchWithFallback(remoteUrl, localUrl) {
    try {
      const r = await fetch(remoteUrl, { cache: 'no-cache' });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return await r.json();
    } catch {
      const f = await fetch(localUrl);
      if (!f.ok) throw new Error(`HTTP ${f.status}`);
      return await f.json();
    }
  }

  const configs = {
    com: {
      sectionApiRemote: `${apiRemoteBase}reflexlibs2018`,
      sectionApiLocal:  `${apiLocalBase}reflexlibs2018.json`,
      langApiRemote:    `${apiRemoteBase}reflexlanguages2018`,
      langApiLocal:     `${apiLocalBase}reflexlanguages2018.json`,
      logoKey:          'com',
      icons:            ['CPlusPlus','CSharp'],
      link:             'https://www.reflexlibs.com',
      bgClass:          'white-bg'
    },
    ai: {
      sectionApiRemote: `${apiRemoteBase}reflexlibs2025`,
      sectionApiLocal:  `${apiLocalBase}reflexlibs2025.json`,
      langApiRemote:    `${apiRemoteBase}reflexlanguages2025`,
      langApiLocal:     `${apiLocalBase}reflexlanguages2025.json`,
      logoKey:          'ai',
      icons:            ['CPlusPlus','CSharp','Python','Rust','JavaScript'],
      link:             'https://www.reflexlibs.ai',
      bgClass:          'black-bg'
    }
  };

  function renderColumn(containerId, cfg) {
    const c = document.getElementById(containerId);
    c.className = `column ${cfg.bgClass}`;

    // Header
    const header = document.createElement('div');
    header.style.marginBottom = '1rem';
    header.innerHTML = `
      <div>Environment: <strong>${DevOrProd}${isLocal ? ' (local)' : ''}</strong></div>
      <div class="version">Version: <em>…loading…</em></div>
      <div class="timestamp">Last updated: <em>…loading…</em></div>
    `;
    c.appendChild(header);

    // TODO: insert logo + icon + language-list rendering here if needed

    fetchWithFallback(cfg.sectionApiRemote, cfg.sectionApiLocal)
      .then(payload => {
        if (payload.version) {
          header.querySelector('.version > em').textContent = payload.version;
        }
        if (payload.timestamp) {
          const dt = new Date(payload.timestamp);
          const pad = (n,z=2) => n.toString().padStart(z,'0');
          const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
          const formatted = 
            `${pad(dt.getUTCDate())}-${monthNames[dt.getUTCMonth()]}-${dt.getUTCFullYear()} ` +
            `${pad(dt.getUTCHours())}:${pad(dt.getUTCMinutes())}:` +
            `${pad(dt.getUTCSeconds())}.${pad(dt.getUTCMilliseconds(),3)} UTC`;
          header.querySelector('.timestamp > em').textContent = formatted;
        }

        const sections = Array.isArray(payload.sections) ? payload.sections : [];
        sections.forEach(s => {
          const sec = document.createElement('div');
          sec.className = 'section';

          const t = document.createElement('div');
          t.className = 'title';
          t.textContent = `${s.sectionID}. ${s.title}`;
          sec.appendChild(t);

          const ul = document.createElement('ul');
          (s.items || []).forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            ul.appendChild(li);
          });
          sec.appendChild(ul);
          c.appendChild(sec);
        });
      })
      .catch(console.error);
  }

  // **ACTUAL RENDER CALLS**:
  renderColumn('left-container',  configs.com);
  renderColumn('right-container', configs.ai);
</script>

</body>
</html>
